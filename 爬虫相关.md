## Daletou 开奖结果爬取

```js
import fs from 'fs';

const query = {
    pageSize: 30,
    pageNo: 1,
    gameNo: '85',
    provinceId: 0,
    isVerify: 1
}
const URI = 'https://webapi.sporttery.cn/gateway/lottery/getHistoryPageListV1.qry';
const result = [];
let total = 0;

const options = {
    method: 'GET',
    headers: {
        accept: 'application/json, text/javascript, */*; q=0.01',
        'accept-language': 'en-GB,en;q=0.9,zh-CN;q=0.8,zh;q=0.7,en-US;q=0.6',
        origin: 'https://static.sporttery.cn',
        priority: 'u=1, i',
        referer: 'https://static.sporttery.cn/',
        'sec-ch-ua': '"Not;A=Brand";v="99", "Microsoft Edge";v="139", "Chromium";v="139"',
        'sec-ch-ua-mobile': '?0',
        'sec-ch-ua-platform': '"Windows"',
        'sec-fetch-dest': 'empty',
        'sec-fetch-mode': 'cors',
        'sec-fetch-site': 'same-site',
        'user-agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36 Edg/139.0.0.0'
    }
};

do {
    try {
        const params = new URLSearchParams(query).toString();
        const url = `${URI}?${params}`;
        const response = await fetch(url, options);
        const data = await response.json();
        total = data.value.total;
        if (data.value.list && data.value.list.length > 0) {
            result.push(...data.value.list);
        }
        query.pageNo++;
        console.log(`Fetched page ${query.pageNo}, total: ${total}`);
    } catch (error) {
        console.error(error);
    }
} while (result.length < total);

console.log(result, result.length);
fs.writeFileSync('./lottery-history.json', JSON.stringify(result.reverse(), null, 2), 'utf-8');
```

## 开彩网开奖结果爬取

```js
import fs from 'fs';
import path from 'path';


class ZhcwRequestFactory {

    constructor(baseUrl = 'https://jc.zhcw.com/port/client_json.php') {
        this.baseUrl = baseUrl;
        this.defaultHeaders = {
            'accept': '*/*',
            'accept-language': 'zh-CN,zh;q=0.9',
            'sec-ch-ua': '"Not_A Brand";v="8", "Chromium";v="120"',
            'sec-ch-ua-mobile': '?0',
            'sec-ch-ua-platform': '"Windows"',
            'sec-fetch-dest': 'script',
            'sec-fetch-mode': 'no-cors',
            'sec-fetch-site': 'same-site',
            'Referer': 'https://www.zhcw.com:8443/',
            'Referrer-Policy': 'strict-origin-when-cross-origin'
        };
    }

    createRequest(options) {
        return {
            fetch: async () => {
                const url = this._buildUrl(options);
                const headers = this._mergeHeaders(options.headers);

                try {
                    const response = await fetch(url, {
                        method: options.method || 'GET',
                        headers: headers,
                        body: options.body || null
                    });

                    return this._handleResponse(response, options.callbackName);
                } catch (error) {
                    throw new Error(`Request failed: ${error.message}`);
                }
            }
        };
    }

    _buildUrl(options) {
        const params = new URLSearchParams();

        const defaultParams = {
            callback: `jQuery${this._generateRandomCallbackId()}`,
            transactionType: '10001001',
            lotteryId: '281',
            issueCount: '10000',
            type: '0',
            pageNum: '1',
            pageSize: '10000',
            tt: Math.random().toString().substring(2),
            _: Date.now()
        };

        const finalParams = { ...defaultParams, ...options.params };

        for (const [key, value] of Object.entries(finalParams)) {
            if (value !== undefined && value !== null && value !== '') {
                params.append(key, value);
            }
        }

        return `${this.baseUrl}?${params.toString()}`;
    }

    _mergeHeaders(customHeaders = {}) {
        return { ...this.defaultHeaders, ...customHeaders };
    }

    async _handleResponse(response, callbackName) {
        if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
        }

        const text = await response.text();

        if (callbackName) {
            const jsonpRegex = new RegExp(`${callbackName}\\((.*)\\)`);
            const match = text.match(jsonpRegex);

            if (match && match[1]) {
                try {
                    return JSON.parse(match[1]);
                } catch (e) {
                    throw new Error('Failed to parse JSONP response');
                }
            }
        }

        try {
            return JSON.parse(text);
        } catch (e) {
            return text;
        }
    }

    _generateRandomCallbackId() {
        return `${Math.random().toString().substring(2)}_${Date.now()}`;
    }
}

async function main() {
    const factory = new ZhcwRequestFactory();
    const lotteryRequest = factory.createRequest({
        method: 'GET',
        params: {
            lotteryId: '281',
            issueCount: '100'
        },
        headers: {
            'cookie': 'PHPSESSID=qn1cbcf9evh3ksj4sp0oi52eu4; _gid=GA1.2.1264646583.1750298115;'
        }
    });

    try {
        const result = await lotteryRequest.fetch();
        const json = result.slice(result.indexOf('(') + 1, result.indexOf(')'));
        const parse = JSON.parse(json);
        parse.data.forEach(el => {
            delete el.winnerDetails;
        })
        const array = parse.data.map(el => {
            return `${el.frontWinningNum}, ${el.backWinningNum}`
        }).reverse();
        const originArray = parse.data.reverse();

        fs.writeFileSync(path.resolve(process.cwd(), './data/origin.json'), JSON.stringify(originArray, null, 4), { encoding: 'utf-8' });
        fs.writeFileSync(path.resolve(process.cwd(), './data/result.json'), JSON.stringify(array, null, 4), { encoding: 'utf-8' });
        fs.writeFileSync(path.resolve(process.cwd(), './data/lottery.json'), JSON.stringify(parse, null, 4), { encoding: 'utf-8' });
        console.log('请求成功, 文件已写入');
    } catch (error) {
        console.error('请求失败:', error);
    }
}

main();


```








